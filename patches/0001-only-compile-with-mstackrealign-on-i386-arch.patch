From de6ff6f55c2914c3c699d218b00e2c5178b48f62 Mon Sep 17 00:00:00 2001
From: Tung Huynh <tung75605@gmail.com>
Date: Fri, 8 Dec 2023 01:00:12 -0800
Subject: [PATCH] only compile with mstackrealign on i386 arch

---
 contrib/src/flac/rules.mak | 2 ++
 contrib/src/vpx/rules.mak  | 2 +-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/contrib/src/flac/rules.mak b/contrib/src/flac/rules.mak
index 1933b0d242..867fd23c77 100644
--- a/contrib/src/flac/rules.mak
+++ b/contrib/src/flac/rules.mak
@@ -50,7 +50,9 @@ endif
 
 FLAC_CFLAGS := $(CFLAGS)
 ifdef HAVE_WIN32
+ifeq ($(ARCH),i386)
 FLAC_CFLAGS += -mstackrealign
+endif
 FLAC_CFLAGS +="-DFLAC__NO_DLL"
 endif
 
diff --git a/contrib/src/vpx/rules.mak b/contrib/src/vpx/rules.mak
index 37f23ca17e..7593b10586 100644
--- a/contrib/src/vpx/rules.mak
+++ b/contrib/src/vpx/rules.mak
@@ -123,7 +123,7 @@ endif
 
 ifndef HAVE_WIN32
 VPX_CONF += --enable-pic
-else
+else ifeq ($(ARCH),i386)
 VPX_CONF += --extra-cflags="-mstackrealign"
 endif
 ifdef HAVE_DARWIN_OS
-- 
2.42.0.windows.2

